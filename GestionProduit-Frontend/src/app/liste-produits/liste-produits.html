<div class="container mt-4">
  <!-- Search Section -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <div class="row">
        <div class="col-md-8 col-lg-6 mx-auto">
          <label class="form-label fw-bold">
            <i class="bi bi-search me-2"></i>Recherche
          </label>
          <input
            class="form-control form-control-lg"
            [(ngModel)]="searchText"
            placeholder="Rechercher un produit...">
        </div>
      </div>
    </div>
  </div>

  <!-- Products Table -->
  @if (products.length>0){
    <div >
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0">
            <i class="bi bi-box-seam me-2"></i>Liste des Produits
          </h5>
          <button
            class="btn btn-light btn-sm"
            (click)="handleClick(state)">
            <i class="bi bi-eye me-1"></i>
            {{ state ? 'Masquer' : 'Afficher' }} Images
          </button>
          <button type="button" class="btn btn-light" (click)="formBuilder()">Ajouter</button>
        </div>

        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
              <thead class="table-dark">
              <tr>
                <th scope="col" class="text-center">#ID</th>
                @if (state){<th scope="col" class="text-center" >Image</th>}
                <th scope="col">Nom</th>
                <th scope="col" class="text-end">Prix</th>
                <th scope="col" class="text-center">Quantité</th>
                <th scope="col" class="text-center">Actions</th>
              </tr>
              </thead>

              <tbody>
                @for (product of filteredData; track $index){
                  <tr>
                    <td class="text-center align-middle">
                      <span class="badge bg-secondary">{{ product.id }}</span>
                    </td>

                    @if (state){
                      <td class="text-center align-middle">
                        <img [src]="'http://localhost:8080/images/' + product.image_path"
                             alt="{{product.nom}}"
                             class="img-fluid img-thumbnail"
                             style="max-width: 250px; max-height: 250px; object-fit: cover;">
                      </td>
                    }

                    <td class="align-middle">
                  <span
                    [ngClass]="product.quantite > 0 ? 'text-dark fw-bold' : 'text-danger fw-bold'">
                    {{ product.nom }}
                  </span>
                      @if (product.quantite === 0){
                        <span
                          class="badge bg-danger ms-2">
                    Rupture
                  </span>
                      }

                    </td>

                    <td class="text-end align-middle fw-semibold">
                      {{ product.prix | currency:'TND':'symbol':'1.2-2' }}
                    </td>

                    <td class="text-center align-middle">
                  <span
                    [ngClass]="product.quantite > 0
                      ? 'badge bg-success'
                      : 'badge bg-danger'">
                    {{ product.quantite }}
                  </span>
                    </td>
                    <td class="text-center align-middle">
                      <a
                        class="btn btn-outline-info btn-sm mx-1"
                        [routerLink]="['/details', product.id]">
                        <i class="bi bi-info-circle me-1"></i>Détails
                      </a>
                      <button
                        class="btn btn-outline-danger btn-sm mx-1"
                        (click)="showConfirmDeleteDialog(product.id)"
                        title="Delete product">
                        <i class="bi bi-trash me-1"></i>Delete
                      </button>
                      <a
                        class="btn btn-outline-warning btn-sm mx-1"
                        (click)="formBuilder(product.id)">
                        <i class="bi bi-pencil me-1"></i>Update
                      </a>

                    </td>

                  </tr>

                }

              </tbody>
            </table>
          </div>
        </div>

        <div class="card-footer text-muted text-center">
          <small>Total: {{ filteredData.length }} produit(s)</small>
        </div>
      </div>
    </div>
  } @else {
      <div class="alert alert-warning shadow-sm d-flex align-items-center" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-3 fs-4"></i>
        <div>
          <h5 class="alert-heading mb-1">Aucun produit disponible</h5>
          <p class="mb-0">La table des produits est actuellement vide.</p>
        </div>
      </div>
  }



